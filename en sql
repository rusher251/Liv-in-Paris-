-- Schéma de base de données pour Liv'In Paris

-- Table des utilisateurs (peuvent être clients et/ou cuisiniers)
CREATE TABLE Utilisateurs (
    IdUtilisateur INT PRIMARY KEY AUTO_INCREMENT,
    Prenom VARCHAR(50) NOT NULL,
    Nom VARCHAR(50) NOT NULL,
    Email VARCHAR(100) UNIQUE NOT NULL,
    MotDePasse VARCHAR(100) NOT NULL,
    Adresse VARCHAR(200) NOT NULL,
    Telephone VARCHAR(20) NOT NULL,
    EstCuisinier BOOLEAN DEFAULT FALSE,
    EstEntreprise BOOLEAN DEFAULT FALSE,
    NomEntreprise VARCHAR(100),
    DateInscription DATETIME DEFAULT CURRENT_TIMESTAMP
)ENGINE=InnoDB;

-- Table des plats
CREATE TABLE Plats (
    IdPlat INT PRIMARY KEY AUTO_INCREMENT,
    IdCuisinier INT NOT NULL,
    Nom VARCHAR(100) NOT NULL,
    Description TEXT,
    Categorie ENUM('Entrée', 'Plat principal', 'Dessert') NOT NULL,
    Prix DECIMAL(10, 2) NOT NULL,
    Portions INT NOT NULL,
    NationaliteCuisine VARCHAR(50),
    TypeRegime VARCHAR(50), -- Végétarien, Halal, etc.
    Ingredients TEXT,
    DatePreparation DATETIME NOT NULL,
    DatePeremption DATETIME NOT NULL,
    CheminPhoto VARCHAR(255),
    FOREIGN KEY (IdCuisinier) REFERENCES Utilisateurs(IdUtilisateur)
)ENGINE=InnoDB;

-- Table des commandes
CREATE TABLE Commandes (
    IdCommande INT PRIMARY KEY AUTO_INCREMENT,
    IdClient INT NOT NULL,
    DateCommande DATETIME DEFAULT CURRENT_TIMESTAMP,
    MontantTotal DECIMAL(10, 2) NOT NULL,
    Statut ENUM('En attente', 'Confirmée', 'Livrée', 'Annulée') DEFAULT 'En attente',
    FOREIGN KEY (IdClient) REFERENCES Utilisateurs(IdUtilisateur)
)ENGINE=InnoDB;

-- Table des éléments de commande
CREATE TABLE ElementsCommande (
    IdElementCommande INT PRIMARY KEY AUTO_INCREMENT,
    IdCommande INT NOT NULL,
    IdPlat INT NOT NULL,
    Quantite INT NOT NULL,
    PrixUnitaire DECIMAL(10, 2) NOT NULL,
    DateLivraison DATETIME NOT NULL,
    AdresseLivraison VARCHAR(200) NOT NULL,
    Statut ENUM('En attente', 'En préparation', 'Prête', 'Livrée') DEFAULT 'En attente',
    FOREIGN KEY (IdCommande) REFERENCES Commandes(IdCommande),
    FOREIGN KEY (IdPlat) REFERENCES Plats(IdPlat)
)ENGINE=InnoDB;

-- Table des trajets de livraison
CREATE TABLE TrajetsLivraison (
    IdTrajet INT PRIMARY KEY AUTO_INCREMENT,
    IdElementCommande INT NOT NULL,
    IdStationDepart INT,
    IdStationArrivee INT,
    DescriptionTrajet TEXT,
    TempsEstime INT, -- en minutes
    FOREIGN KEY (IdElementCommande) REFERENCES ElementsCommande(IdElementCommande)
)ENGINE=InnoDB;

-- Table des avis
CREATE TABLE Avis (
    IdAvis INT PRIMARY KEY AUTO_INCREMENT,
    IdElementCommande INT NOT NULL,
    Note INT NOT NULL CHECK (Note BETWEEN 1 AND 5),
    Commentaire TEXT,
    DateAvis DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (IdElementCommande) REFERENCES ElementsCommande(IdElementCommande)
)ENGINE=InnoDB;
